<div class="dashboard-container">
  <header class="dashboard-header">
    <div class="header-left">
      <div class="logo">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 3v18h18"></path>
          <path d="m19 9-5 5-4-4-3 3"></path>
        </svg>
      </div>
      <h1>Sistema Bibliom√©trico</h1>
    </div>
    <div class="header-right">
      <div class="user-info">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        <span>{{ currentUser?.nombre }}</span>
      </div>
      <button class="btn-logout" (click)="logout()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16 17 21 12 16 7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
        Salir
      </button>
    </div>
  </header>

  <div class="dashboard-content">
    <div class="upload-section">
      <button class="btn-upload-main" (click)="goToUpload()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="17 8 12 3 7 8"></polyline>
          <line x1="12" y1="3" x2="12" y2="15"></line>
        </svg>
        + Cargar Nueva Tesis
      </button>
    </div>

    <!-- ‚úÖ Aplicamos el disparador de la animaci√≥n al contenedor de las tarjetas -->
    <div class="stats-grid" [@listAnimation]>
      <div class="stat-card stat-total">
        <div class="stat-icon">üìä</div>
        <div class="stat-content">
          <p class="stat-label">Total Tesis</p>
          <p class="stat-value">{{ statistics.total }}</p>
        </div>
      </div>
      <div class="stat-card stat-average">
        <div class="stat-icon">üìà</div>
        <div class="stat-content">
          <p class="stat-label">Promedio</p>
          <p class="stat-value">{{ statistics.promedio.toFixed(1) }}%</p>
        </div>
      </div>
      <div class="stat-card stat-excellent">
        <div class="stat-icon">‚≠ê</div>
        <div class="stat-content">
          <p class="stat-label">Excelentes</p>
          <p class="stat-value">{{ statistics.categorias['Excelente'] || 0 }}</p>
        </div>
      </div>
      <div class="stat-card stat-month">
        <div class="stat-icon">üìÖ</div>
        <div class="stat-content">
          <p class="stat-label">Este Mes</p>
          <p class="stat-value">{{ statistics.thisMonth }}</p>
        </div>
      </div>
    </div>

    <div class="table-container">
      <div class="table-header">
        <h2>Historial de Tesis Analizadas</h2>
        <div class="filters">
          <input 
            type="text" 
            class="search-input" 
            placeholder="üîç Buscar por t√≠tulo o autor..."
            [(ngModel)]="searchTerm"
            (keyup.enter)="onSearch()"
          />
          <select class="filter-select" [(ngModel)]="selectedYear" (change)="onFilterChange()">
            <option [ngValue]="null">Todos los a√±os</option>
            <option *ngFor="let year of years" [value]="year">{{ year }}</option>
          </select>
          <button class="btn-clear-filters" (click)="clearFilters()" *ngIf="searchTerm || selectedYear">
            Limpiar filtros
          </button>
        </div>
      </div>
      <div *ngIf="loading" class="loading-container">
        <div class="spinner-large"></div>
        <p>Cargando tesis...</p>
      </div>
      <div *ngIf="!loading && thesisList.length > 0" class="table-wrapper">
        <table class="thesis-table">
          <thead>
            <tr>
              <th>T√≠tulo</th>
              <th>Autor</th>
              <th>A√±o</th>
              <th>Calificaci√≥n</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody [@listAnimation]="thesisList.length">
            <tr *ngFor="let thesis of thesisList">
              <td>{{ truncateText(thesis.titulo, 60) }}</td>
              <td>{{ thesis.autor }}</td>
              <td>{{ thesis.anio }}</td>
              <td>
                <div class="score-cell">
                  <span class="badge" [ngClass]="getCategoryClass(thesis.categoria)">{{ thesis.categoria }}</span>
                  <span class="score">{{ thesis.calificacionPredicha | number:'1.0-1' }}%</span>
                </div>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="btn-view" (click)="viewDiagnostic(thesis._id!)" title="Ver diagn√≥stico">
                    üëÅ Ver
                  </button>
                  <button class="btn-download" (click)="downloadDiagnostic(thesis)" title="Descargar Diagn√≥stico en PDF" [disabled]="isDownloading">
                    ‚¨á PDF
                  </button>
                  <button class="btn-delete" (click)="deleteThesis(thesis._id!)" title="Eliminar tesis">
                    üóëÔ∏è Eliminar
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div *ngIf="!loading && thesisList.length === 0" class="no-results">
        <p>No se encontraron tesis</p>
        <button class="btn-upload-secondary" (click)="goToUpload()">Cargar primera tesis</button>
      </div>
      <div *ngIf="!loading && thesisList.length > 0" class="pagination">
        <button class="btn-page" (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
          ‚Üê Anterior
        </button>
        <div class="page-numbers">
          <button 
            *ngFor="let page of [].constructor(totalPages); let i = index"
            class="btn-page-number"
            [class.active]="currentPage === i + 1"
            (click)="goToPage(i + 1)">
            {{ i + 1 }}
          </button>
        </div>
        <button class="btn-page" (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">
          Siguiente ‚Üí
        </button>
        <div class="pagination-info">
          Mostrando {{ (currentPage - 1) * pageSize + 1 }} - {{ Math.min(currentPage * pageSize, totalTheses) }} de {{ totalTheses }} tesis
        </div>
      </div>
    </div>
  </div>
</div>